# OPAL campaign configuration

campaign:
  name: "60 bp promoter DNA — AND GATE : ethanol + ciprofloxacin — cpxR + LexA binding sites"
  slug: "prom60-etoh-cipro-andgate"
  workdir: "."  # resolved relative to the campaign root

data:
  location: { kind: usr, path: ../../../usr/datasets, dataset: 60bp_dual_promoter_cpxR_LexA }
  x_column_name: "infer__evo2_7b__60bp_dual_promoter_cpxR_LexA__logits_mean"
  y_column_name: "sfxi_8_vector_y_label"
  y_expected_length: 8

ingest:
  duplicate_policy: "error"

training:
  policy:
    cumulative_training: true
    label_cross_round_deduplication_policy: "latest_only"
    allow_resuggesting_candidates_until_labeled: true
  # Ephemeral Y-ops used at fit-time and inverted at predict-time
  y_ops:
    - name: intensity_median_iqr     # scales indices 4:8 only; no log2 changes here
      params:
        min_labels: 5
        center: median
        scale: iqr
        eps: 1e-8

# --------------------------
# Plugin blocks (registry-first)
# --------------------------

transforms_x: { name: identity, params: {} }

# for ingesting CSV → Y only (unchanged)
transforms_y:
  name: sfxi_vec8_from_table_v1
  params:
    sequence_column: sequence
    logic_columns: ["v00","v10","v01","v11"]
    intensity_columns: ["y00_star","y10_star","y01_star","y11_star"]

model:
  name: random_forest
  params:
    n_estimators: 100
    criterion: "friedman_mse"
    bootstrap: true
    oob_score: true
    random_state: 1
    n_jobs: -1
    emit_feature_importance: true

objective:
  name: "sfxi_v1"
  params:
    setpoint_vector: [0, 0, 0, 1]
    logic_exponent_beta: 1.0
    intensity_exponent_gamma: 1.0
    intensity_log2_offset_delta: 0.0
    scaling: { percentile: 95, min_n: 5, eps: 1.0e-8 }

selection:
  name: "top_n"
  params:
    top_k: 10
    tie_handling: "competition_rank"
    objective_mode: "maximize"   # minimize|maximize

scoring:
  score_batch_size: 1000

safety:
  fail_on_mixed_biotype_or_alphabet: true
  require_biotype_and_alphabet_on_init: true
  conflict_policy_on_duplicate_ids: "error"
  write_back_requires_columns_present: true
  accept_x_mismatch: false

metadata:
  notes: "SFXI (vec8) and identity X."

plot_config: plots.yaml
