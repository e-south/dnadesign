# densegen/config.yaml

densegen:
  inputs:
    - name: 60bp_dual_promoter_cpxR_LexA
      type: csv_tfbs
      path: inputs/tf2tfbs_mapping_cpxR_LexA.csv

  output:
    kind: usr               # usr | jsonl | both
    jsonl:
      path: outputs/60bp_dual_promoter_cpxR_LexA.jsonl

  usr:
    dataset: 60bp_dual_promoter_cpxR_LexA
    root: null
    namespace: densegen
    chunk_size: 10
    allow_overwrite: true

  generation:
    sequence_length: 60
    quota: 30000
    sampling:
      subsample_over_length_budget_by: 120
      cover_all_tfs: true              # ≥1 TFBS per TF
      unique_binding_sites: true       # no duplicate TFBS strings
      max_sites_per_tf: null           # (optional) allow extra per TF after coverage
      relax_on_exhaustion: true

    plan:
      - name: sigma70_high
        quota: 10000
        fixed_elements:
          promoter_constraints:
            upstream: "TTGACA"
            downstream: "TATAAT"
            spacer_length: [16, 18]
            upstream_pos: [0, 60]
      - name: sigma70_mid
        quota: 10000
        fixed_elements:
          promoter_constraints:
            upstream: "ACCGCG"
            downstream: "TATAAT"
            spacer_length: [16, 18]
            upstream_pos: [0, 60]
      - name: sigma70_low
        quota: 10000
        fixed_elements:
          promoter_constraints:
            upstream: "GCAGGT"
            downstream: "TATAAT"
            spacer_length: [16, 18]
            upstream_pos: [0, 60]

  solver:
    backend: GUROBI                      # chosen once at startup; if probe fails we fall back to CBC
    diverse_solution: true
    options:
      - "Threads=16"
      - "TimeLimit=10"

  runtime:
    round_robin: true
    arrays_generated_before_resample: 20
    require_min_count_per_tf: true  # enforce >= 1 site per TF in the final solution (post-solve check).
    # min_count_per_tf: 1   # (optional, overrides the boolean above if provided)
    max_duplicate_solutions: 3
    stall_seconds_before_resample: 5
    stall_warning_every_seconds: 15
    max_resample_attempts: 3
    random_seed: 42

  postprocess:
    fill_gap: true
    fill_gap_end: "5prime"
    fill_gc_min: 0.40
    fill_gc_max: 0.60

  logging:
    level: INFO
    suppress_solver_stderr: true       # dedupe native CBC "parameters as string not supported" spam
    print_visual: true                 # print the ILP visual per solution (fresh line, un-clipped)

plots:
    # This path is resolved under the DenseGen tree when relative:
    # dnadesign/densegen/outputs/plots/
    out_dir: outputs/plots

    # Global style: bigger fonts across the board
    style:
      font_size: 14        # title≈15.4, ticks≈12.6 by default
      palette: tab10
      seaborn_style: true
      despine: true
      legend_frame: false

    # Which plots to render
    default:
      - compression_ratio
      - tf_usage
      - tfbs_usage          # NEW: ranked binding-site counts
      - plan_counts
      - tf_coverage
      - tfbs_length_density
      - gap_fill_gc         # now a scatter: GC fraction vs gap bases

    options:
      compression_ratio:
        dims: [6, 6]

      tf_usage:             # total counts (no top-k)
        dims: [6, 6]

      tfbs_usage:
        dims: [32, 6]
        # max_sites: 60     # optional cap if you ever need it

      plan_counts:
        dims: [6, 6]

      tf_coverage:
        dims: [16, 3]
        normalize: false
        fill: true
        fill_alpha: 0.35
        stacked: false
        smooth_window: 3

      tfbs_length_density:
        dims: [6, 6]
        kde: true
        kde_points: 256
        fill_alpha: 0.25

      gap_fill_gc:
        dims: [6, 6]        # scatter: x=GC fraction, y=gap bases