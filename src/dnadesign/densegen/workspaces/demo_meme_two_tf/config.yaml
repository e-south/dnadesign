# DenseGen demo: two TF motifs (LexA + CpxR) with bounded PWM sampling.
# Source: Cruncher basic demo MEME files (lexA + cpxR) copied into this demo for
# reproducibility. Parsing uses Cruncherâ€™s MEME parser (DRY).
# Motif widths: lexA=22, cpxR=21.

densegen:
  schema_version: "2.4"
  run:
    id: demo_meme_two_tf
    root: "."

  inputs:
    # LexA + CpxR MEME motifs from Cruncher demo basics, merged into one TF pool.
    # Motif ids expected in these files: lexA, cpxR.
    - name: lexA_cpxR_meme
      type: pwm_meme_set
      paths:
        - inputs/lexA.txt
        - inputs/cpxR.txt
      motif_ids: [lexA, cpxR]
      sampling:
        strategy: stochastic
        n_sites: 80
        oversample_factor: 200
        scoring_backend: fimo
        pvalue_threshold: 1e-4
        selection_policy: stratified
        mining:
          batch_size: 5000
          max_seconds: 60
          retain_bin_ids: [0, 1, 2, 3]
          log_every_batches: 1
        length_policy: range
        length_range: [22, 28]

  output:
    targets: [parquet]
    schema:
      bio_type: dna
      alphabet: dna_4
    parquet:
      path: outputs/dense_arrays.parquet
      deduplicate: true
      chunk_size: 64

  generation:
    sequence_length: 60
    quota: 50
    sampling:
      pool_strategy: subsample
      library_size: 24
      subsample_over_length_budget_by: 80
      library_sampling_strategy: coverage_weighted
      coverage_boost_alpha: 0.15
      coverage_boost_power: 1.0
      cover_all_regulators: true
      unique_binding_sites: true
      max_sites_per_regulator: null
      relax_on_exhaustion: false
      allow_incomplete_coverage: false
      iterative_max_libraries: 25
      iterative_min_new_solutions: 1

    plan:
      - name: meme_demo
        quota: 50
        required_regulators: [lexA, cpxR]

  solver:
    backend: CBC
    strategy: iterate
    options: []

  runtime:
    round_robin: true
    arrays_generated_before_resample: 2
    min_count_per_tf: 0
    max_duplicate_solutions: 3
    stall_seconds_before_resample: 10
    stall_warning_every_seconds: 10
    max_resample_attempts: 2
    max_total_resamples: 50
    max_seconds_per_plan: 0
    max_failed_solutions: 0
    random_seed: 42

  postprocess:
    gap_fill:
      mode: adaptive
      end: 5prime
      gc_min: 0.40
      gc_max: 0.60
      max_tries: 2000

  logging:
    log_dir: outputs/logs
    level: INFO
    suppress_solver_stderr: true
    print_visual: true
    progress_style: screen
    progress_every: 1
    progress_refresh_seconds: 1.0

plots:
  source: parquet
  out_dir: outputs
  format: png
