# DenseGen demo: binding-site baseline plus sigma70-constrained variant.
densegen:
  schema_version: "2.9"
  run:
    id: demo_tfbs_baseline
    root: "."

  inputs:
    - name: basic_sites
      type: binding_sites
      path: inputs/sites.csv

  output:
    targets: [parquet]
    schema:
      bio_type: dna
      alphabet: dna_4
    parquet:
      path: outputs/tables/records.parquet
      deduplicate: true
      chunk_size: 64

  generation:
    sequence_length: 100
    sampling:
      pool_strategy: iterative_subsample
      library_size: 10
      cover_all_regulators: true
      unique_binding_sites: true
      unique_binding_cores: true
      iterative_max_libraries: 200
    plan:
      - name: baseline
        sequences: 50
        sampling:
          include_inputs: [basic_sites]
        regulator_constraints:
          groups: []
      - name: baseline_sigma70
        sequences: 50
        sampling:
          include_inputs: [basic_sites]
        fixed_elements:
          promoter_constraints:
            - name: sigma70_consensus
              upstream: TTGACA
              downstream: TATAAT
              spacer_length: [16, 18]
        regulator_constraints:
          groups: []

  solver:
    backend: CBC
    strategy: iterate
    solver_attempt_timeout_seconds: 10

  runtime:
    round_robin: true
    max_accepted_per_library: 10
    min_count_per_tf: 0
    max_duplicate_solutions: 3
    no_progress_seconds_before_resample: 10
    max_consecutive_no_progress_resamples: 60
    max_failed_solutions: 0
    random_seed: 42

  postprocess:
    pad:
      mode: adaptive
      end: 5prime
      gc:
        mode: range
        min: 0.40
        max: 0.60
        target: 0.50
        tolerance: 0.10
        min_pad_length: 0
      max_tries: 2000

  logging:
    log_dir: outputs/logs
    level: INFO
    progress_style: summary

plots:
  source: parquet
  out_dir: outputs/plots
  format: pdf
  default: [stage_a_summary, placement_map, run_health, tfbs_usage]
