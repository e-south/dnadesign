# DenseGen audit notes (2026-01-23)

- Scope: densegen end-to-end audit, CLI demo flow, outputs organization review.
- Branch: densegen/cruncher-refine.

## In-progress
- Run full densegen test suite after latest fixes.
- Re-run demo flow (validate-config, stage-a, stage-b, run, inspect run --library, report, plot, campaign-reset).
- Summarize outputs organization findings + inefficiencies.

## Changes applied
- Fixed report library summary to fill missing outputs counts (prevents NaN crash in `dense inspect run --library`).
- Added regression test for missing outputs counts; added shared test fixture helper.
- Added tests package `__init__.py` for shared fixtures.

## Demo run notes
- `dense run` initial attempt timed out in the shell (120s) while still running; resumed with `dense run --resume` and completed.
- `dense inspect run --library --events` now succeeds (outputs column no longer NaN).
- `dense report --format md` writes `outputs/report` summaries only; plots live in `outputs/plots`.

## Output layout snapshot (demo60)
- Total files: 55
- Largest dirs: `outputs/report` (~560K), `outputs/tables` (~356K), `.mpl-cache` (~160K).
- Tables: `dense_arrays.parquet` (canonical), `solutions.parquet` (solutionâ†”attempt mapping),
  `composition.parquet` (per-placement), `attempts.parquet` (solver audit log).
- Plots are consolidated under `outputs/plots` and indexed in `outputs/plots/plot_manifest.json`.

## Open questions / potential improvements
- Consider reducing duplication between `attempts.parquet` and `libraries/*` (library TFBS lists
  appear in both) or making library details join-only via `library_members.parquet`.
- Report currently links plots only when `--plots include` is set; consider a summary-only plot preset.
- `.mpl-cache` sits under outputs; consider doc note about cleaning via `dense campaign-reset`.

## Commands executed
- pixi run dense campaign-reset -c demo60/config.yaml
- pixi run dense validate-config --probe-solver -c demo60/config.yaml
- pixi run dense inspect inputs -c demo60/config.yaml
- pixi run dense inspect config -c demo60/config.yaml
- pixi run dense stage-a build-pool -c demo60/config.yaml
- pixi run dense stage-b build-libraries -c demo60/config.yaml
- pixi run dense run -c demo60/config.yaml (timed out at 120s)
- pixi run dense run --resume -c demo60/config.yaml
- pixi run dense inspect run --library --events -c demo60/config.yaml
- pixi run dense report -c demo60/config.yaml --format md
- pixi run dense ls-plots
- pixi run dense plot --only placement_map,tfbs_usage,run_health -c demo60/config.yaml
- uv run pytest -q src/dnadesign/densegen/tests
- uv run ruff check src/dnadesign/densegen
- uv run ruff format src/dnadesign/densegen
